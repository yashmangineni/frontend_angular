import{b as u,c as g}from"./chunk-MCX6SJYU.js";import{I as f,O as m,S as c,a as d,ea as h,m as a,q as l,y as o}from"./chunk-DXOJW474.js";var p=class n{constructor(e){this.http=e}apiUrl="http://localhost:3000/api";httpOptions={headers:new u({"Content-Type":"application/json"})};validateEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}validatePassword(e){return e.length<8?{isValid:!1,message:"Password must be at least 8 characters long"}:/[A-Z]/.test(e)?/[a-z]/.test(e)?/\d/.test(e)?/[!@#$%^&*(),.?":{}|<>]/.test(e)?{isValid:!0,message:"Password is valid"}:{isValid:!1,message:"Password must contain at least one special character"}:{isValid:!1,message:"Password must contain at least one digit"}:{isValid:!1,message:"Password must contain at least one lowercase letter"}:{isValid:!1,message:"Password must contain at least one uppercase letter"}}saveUser(e){if(!this.validateEmail(e.email))return a({success:!1,message:"Invalid email format"});let r=this.validatePassword(e.password);return r.isValid?this.http.post(`${this.apiUrl}/users`,e,this.httpOptions).pipe(f(t=>this.sendWelcomeEmail(e.email,e.name).pipe(l(s=>({success:!0,message:"Account created successfully! A welcome email has been sent to your email address.",user:t})),o(s=>(console.error("Email sending failed:",s),a({success:!0,message:"Account created successfully! However, we could not send a welcome email at this time.",user:t}))))),o(t=>(console.error("Signup error:",t),a({success:!1,message:t.error?.message||"Failed to create account"})))):a({success:!1,message:r.message})}sendWelcomeEmail(e,r){return this.http.post(`${this.apiUrl}/send-welcome-email`,{email:e,name:r},this.httpOptions).pipe(l(t=>({success:!0,message:t.message})),o(t=>(console.error("Error sending welcome email:",t),a({success:!1,message:t.error?.message||"Failed to send welcome email"}))))}getUserByEmail(e){return console.log("Getting user from database by email:",e),a(null)}getAllUsers(){return console.log("Getting all users from database"),a([])}static \u0275fac=function(r){return new(r||n)(c(g))};static \u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})};var v=class n{constructor(e,r){this.dbService=e;this.http=r;let t=this.safeGet("auth_current_email");t&&this.currentUserEmail.set(t)}currentUserEmail=h(null);apiUrl="http://localhost:3000/api";httpOptions={headers:new u({"Content-Type":"application/json"})};signup(e,r,t){return console.log("AuthService: Attempting signup with:",{name:e,email:r,password:t}),this.http.post(`${this.apiUrl}/users`,{name:e,email:r,password:t},this.httpOptions).pipe(l(s=>{console.log("AuthService: Signup response from backend:",s);try{let i=JSON.parse(localStorage.getItem("users")||"[]");s.user&&(i.push(s.user),localStorage.setItem("users",JSON.stringify(i)))}catch(i){console.error("AuthService: Error storing user data in localStorage:",i)}return{ok:s.success,message:s.message}}),o(s=>(console.error("AuthService: Signup error caught:",s),a({ok:!1,message:s.error?.message||"Failed to create account"}))))}login(e,r){return this.http.post(`${this.apiUrl}/login`,{email:e,password:r},this.httpOptions).pipe(l(t=>{this.safeSet("auth_current_email",t.user.email),this.currentUserEmail.set(t.user.email),this.safeSet("auth_token",t.token);try{let s=JSON.parse(localStorage.getItem("users")||"[]"),i=s.findIndex(b=>b.email===e);i>=0?s[i]=d(d({},s[i]),t.user):s.push(t.user),localStorage.setItem("users",JSON.stringify(s))}catch(s){console.error("Error storing user data in localStorage:",s)}return{ok:!0}}),o(t=>(console.error("Login error:",t),a({ok:!1,message:t.error?.message||"Invalid email or password"}))))}logout(){this.safeRemove("auth_current_email"),this.safeRemove("auth_token"),this.currentUserEmail.set(null)}isLoggedIn(){return this.currentUserEmail()!==null&&this.safeGet("auth_token")!==null}getCurrentUser(){if(!this.isLoggedIn())return null;let e=this.currentUserEmail();if(e){try{let t=JSON.parse(localStorage.getItem("users")||"[]").find(s=>s.email===e);if(t)return{id:t.id,name:t.name,email:t.email}}catch{}return{email:e}}return null}safeGet(e){try{return localStorage.getItem(e)}catch{return null}}safeSet(e,r){try{localStorage.setItem(e,r)}catch{}}safeRemove(e){try{localStorage.removeItem(e)}catch{}}static \u0275fac=function(r){return new(r||n)(c(p),c(g))};static \u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})};export{v as a};
